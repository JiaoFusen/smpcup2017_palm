# -*- coding: utf-8 -*-
import numpy as np
import re
import doc_preprocess

class KeywordExtractor():
    def __init__(self):
        self.document_preprocessor = doc_preprocess.DocumentPreprocessor()
        
    def is_stop_word(self, word):
        if word in self.document_preprocessor.it_lexicons:
            return False
        if len(word) > 10 or len(word) < 2:
            return True
        if word in self.document_preprocessor.stopwords:
            return True
        for stop_lexicon in self.document_preprocessor.stop_lexicons:
            if word.find(stop_lexicon) != -1:
                return True
        if re.search('.(某|先生|女士|小姐)', word) or word[0] in self.document_preprocessor.surnames:  # 过滤人名
            return True
        regexs = [r'^[*#-/_]+$', '^[-+]?[0-9]+(\.[0-9]+)?$', '^[0-9]+[年月日]$', '^[0-9a-zA-Z]\.$', '^[0-9]+(\.[0-9]+)+$', 
                  '^[0-9]+(,[0-9]+)+$', '^[0-9]+%$', '^√[0-9]+$', '^[0-9]+(\.[0-9]+)+:[0-9]+$', r'^[-$_|*][a-z]+$', 
                '^//.*$', r'[{}]', r'^[零○一二两三四五六七八九十廿百千万亿壹贰叁肆伍陆柒捌玖拾佰仟]+$', r'^[第这上下东西南北]+[零○一二两三四五六七八九十廿百千万亿壹贰叁肆伍陆柒捌玖拾佰仟]+.?$',
            r'^[零○一二两三四五六七八九十廿百千万亿壹贰叁肆伍陆柒捌玖拾佰仟]+[大种个块天分钟位篇多本秒钟表行分之人章系列年月日成]+[零○一二两三四五六七八九十廿百千万亿壹贰叁肆伍陆柒捌玖拾佰仟]*$',
            r'^[旅星期表项题频骤集钟这逐]+[零○一二两三四五六七八九十廿百千万亿壹贰叁肆伍陆柒捌玖拾佰仟]+$', r'^.*之[零○一二两三四五六七八九十廿百千万亿壹贰叁肆伍陆柒捌玖拾佰仟]+$']
        for regex in regexs:
            if re.match(regex, word):
                return True
        return False
        
        
    def filter_stopwords(self, word_set):
        res = set()
        for word in word_set:
            if not self.is_stop_word(word):
                res.add(word)
        return res
        
        
    def update_tuple_list(self, score, new_score, delete_word):
        res = []
        for pair in score:
            if pair[0] in new_score.keys() and pair[0] not in delete_word:
                res.append((pair[0], new_score[pair[0]]))
            elif pair[0] not in delete_word:
                res.append(pair)
        return res
        
    '''
    alpha: hyper-para about weight of word in title, negative for relative weight against content occurance
    num1: num of keywords extracted finally, negative for extracting all
    num2: num of words to perform long-short word rules
    delete: whether delete the short word
    '''
    def _extract(self, title, content, alpha=0.21, num1 = 3, num2 = 10, delete = True, withscore = False, enrich = True, post = False):
        
        title_word = self.document_preprocessor.convert_it_lexicons(title.lower().split())
        content_word = self.document_preprocessor.convert_it_lexicons(content.lower().split())
        title_word = self.document_preprocessor.combine(title_word)
        content_word = self.document_preprocessor.combine(content_word)
        
        
        alpha = -alpha * len(title_word) / len(content_word) if alpha < 0 else alpha
        
        '''
        统计tf
        '''
        word_tf = {}
        word_tfidf = {}
        for word in title_word:
            if word in word_tf.keys():
                word_tf[word] += alpha * len(content_word) / len(title_word)
            else:
                word_tf[word] = alpha * len(content_word) / len(title_word)
        for word in content_word:
            if word in word_tf.keys():
                word_tf[word] += 1
            else:
                word_tf[word] = 1

        '''
        所有候选词
        '''
        word_set = self.filter_stopwords(set(title_word + content_word))

        '''
        计算tf-idf
        '''
        for word in word_set:
            df = self.document_preprocessor.word_df[word] if word in self.document_preprocessor.word_df.keys() else 1
            word_tfidf[word] = word_tf[word] *  np.log(1000000 / df)
        
        '''
        初步排序并减少候选词
        '''
        score = (sorted(word_tfidf.items(), key=lambda d: d[1], reverse=True))[0:num2]
        
        '''
        rule: 长串score加上子串的score(偏向于长串)
        '''
        new_score = {}
        delete_word = set()
        for i in range(0, len(score)):
            for j in range(0, len(score)):
                if i!=j and len(score[i][0]) <= 4 and score[j][0].find(score[i][0]) != -1:
                    new_score[score[j][0]] = score[j][1] + score[i][1]
                    if delete:
                        delete_word.add(score[i][0])
        
        score = sorted(self.update_tuple_list(score, new_score, delete_word), key=lambda d: d[1], reverse=True)
        
        
        keywords = []

        num1 = len(score) if num1 < 0 else num1

        if enrich:
            for i in range(0, num1):
                if len(score) > i:
                    cur = score[i] if withscore else score[i][0]
                    keywords.append(cur)
                else:
                    cur = ('nan', 0.0) if withscore else 'nan'
                    keywords.append(cur)
        else:
            num1 = min(len(score), num1)
            for i in range(0, num1):
                cur = score[i] if withscore else score[i][0]
                keywords.append(cur)
                
        return title_word, content_word, keywords
        
    def extract(self, title, content, alpha=0.22, num1 = 3, num2 = 10, delete = True, withscore = False, enrich = False, post = False):
        title_word, content_word, keywords = self._extract(title, content, alpha, num1, num2, delete, withscore, enrich, post)
        return keywords

        
        
        
if __name__ =='__main__':
        
    
    
    
    keywordExtractor = KeywordExtractor()
    
    
    title = "六足 机器 人 的 实现 原理"
    content = "缘由 ： 在 自然界 和 人类 社会 中 存在 一些 人类 无法 到达 的 地方 和 可能 危及 人类 生命 的 特殊 场合 。 如 行星 表面 、 灾难 发生 矿井 、 防灾 救援 和 反恐 斗争 等 ， 对 这些 危险 环境 进行 不断 地 探索 和 研究 ， 寻求 一条 解决问题 的 可行 途径 成为 科学技术 发展 和 人类 社会 进步 的 需要 。 地形 不规则 和 崎岖不平 是 这些 环境 的 共同 特点 。 从而 使 轮式 机器 人 和 履带式 机器 人 的 应用 受到限制 。 以往 的 研究 表明 轮式 移动 方式 在 相对 平坦 的 地形 上 行驶 时 ， 具有 相当 的 优势 运动 速度 迅速 、 平稳 ， 结构 和 控制 也 较 简单 ， 但 在 不平 地面 上 行驶 时 ， 能耗 将 大大增加 ， 而 在 松软 地面 或 严重 崎岖不平 的 地形 上 ， 车轮 的 作用 也 将 严重 丧失 移动 效率 大大降低 。 为了 改善 轮子 对 松软 地面 和 不平 地面 的 适应能力 ， 履带式 移动 方式 应运而生 但 履带式 机器 人 在 不平 地面 上 的 机动性 仍然 很差 行驶 时 机身 晃动 严重 。 与 轮式 、 履带式 相比 在 崎岖不平 的 路面 步行 机器 人 具有 独特 优越性 能 在 这种 背景 下多足 步行 机器 人 的 研究 蓬勃发展 起来 。 而 仿生 步行 机器 人 的 出现 更加 显示 出 步行 机器 人 的 优势 。 多足 步行 机器 人 的 运动 轨迹 是 一系列 离散 的 足印 运动 时 只 需要 离散 的 点接触 地面 对 环境 的 破坏 程度 也 较 小 可以 在 可能 到达 的 地面 上 选择 最优 的 支撑点 对 崎岖 地形 的 适应性 强 。 正 因为 如此 多足 步行 机器 人 对 环境 的 破坏 程度 也 较 小 。 轮式 和 履带式 机器 人 的 则 是 一条条 连续 的 辙 迹 。 崎岖 地形 中 往往 含有 岩石 、 泥土 、 沙子 甚至 峭壁 和 陡坡 等 障碍物 可以 稳定 支撑 机器 人 的 连续 路径 十分 有限 , 这 意味着 轮式 和 履带式 机器 人 在 这种 地形 中 已经 不 适用 。 多足 步行 机器 人 的 腿部 具有 多个 自由度 使 运动 的 灵活性 大大 增强 。 它 可以 通过 调节 腿 的 长度 保持 身体 水平 也 可以 通过 调节 腿 的 伸展 程度 调整 的 位置 因此 不易 翻倒 稳定性 更高 。 当然 多足 步行 机器 人 也 存在 一些 不足之处 。 比如 为 使 腿部 协调 稳定 运动 从 机械 结构设计 到 控制系统 算法 都 比较复杂 相比 自然界 的 节肢动物 仿生 多足 步行 机器 人 的 机动性 还有 很大 差距 。 仿生 原理 分析 ： 六足 机器 人 又 叫 蜘蛛 机器 人 ， 是 多足 机器 人 的 一种 。 仿生 式 六足 机器 人 ， 顾名思义 ， 六足 机器 人 在 我们 理想 架构 中 ， 我们 借鉴 了 自然界 昆虫 的 运动 原理 。 足 是 昆虫 的 运动 器官 。 昆虫 有 3 对足 ， 在 前胸 、 中胸 和 后 胸 各有 一对 ， 我们 相应 地 称为 前足 、 中足 和 后 足 。 每个 足 由 基节 、 转节 、 腿节 、 胫节 、 跗节 和 前 跗节 几 部分 组成 。 基节 是 足 最 基部 的 一节 ， 多 粗短 。 转节常 与 腿 节 紧密 相连 而 不 活动 。 腿 节 是 最长 最 粗 的 一节 。 第四节 叫胫节 ， 一般 比 较 细长 ， 长着 成排 的 刺 。 第五节 叫 跗节 ， 一般 由 2 - 5 个亚节 组成 ； 为的是 便于 行走 。 在 最 末节 的 端部 还 长 着 两个 又 硬 又 尖 的 爪 ， 可以 用 它们 来 抓住 物体 。 行走 是 以 三条 腿 为 一组 进行 的 ， 即 一侧 的 前 、 后足 与 另一侧 的 中足 为 一组 。 这样 就 形成 了 一个 三角形 支 架结构 ， 当 这三条 腿 放在 地面 并 向 后 蹬 时 ， 另外 三条 腿 即 抬起 向 前 准备 替换 。 前足用 爪 固定物 体后 拉动 虫体 向 前 ， 中足 用来 支持 并 举起 所属 一侧 的 身体 ， 后足 则 推动 虫体 前进 ， 同时 使 虫体 转向 。 这种 行走 方式 使 昆虫 可以 随时随地 停息 下来 ， 因为 重心 总是 落 在 三角 支架 之内 。 并 不是 所有 成虫 都 用 六条 腿 来 行走 ， 有些 昆虫 由于 前足 发生 了 特化 ， 有 了 其他 功用 或 退化 ， 行走 就 主要 靠 中 、 后足来 完成 了 。 大家 最为 熟悉 的 要 算 螳螂 了 ， 我们 常可 看到 螳螂 一对 钳子 般的 前足 高举 在 胸前 ， 而 由 后面 四条 足 支撑 地面 行走 。 三角 步态 介绍 ： 六足 步行 机器 人 的 步态 是 多样 的 ， 其中 三角 步态 是 六足 步行 机器 人 实现 步行 的 典型 步态 。 “ 六足 纲 ” 昆虫 步行 时 ， 一般 不是 六足 同时 直线 前进 ， 而是 将 三 对 足 分成 两组 ， 以 三角形 支 架结构 交替 前行 。 目前 ， 大部分 六足 机器 人 采用 了 仿 昆虫 的 结构 ， 6 条腿 分布 在 身体 的 两侧 ， 身体 左侧 的 前 、 后足 及 右侧 的 中足 为 一组 ， 右侧 的 前 、 后足 和 左侧 的 中足 为 另一组 ， 分别 组成 两个 三角形 支架 ， 依靠 大腿 前后 划动 实现 支撑 和 摆动 过程 ， 这 就是 典型 的 三角 步态 行走 法 ， 如图所示 。 图中 机器 人 的 髋关节 在 水平 和 垂直 方向 上 运动 。 此时 ， b 、 d 、 f 脚为 摆动 脚 ， a 、 c 、 e 脚 原地不动 ， 只是 支撑 身体 向 前 。 由于 身体 重心 低 ， 不用 协调 z 向 运动 ， 容易 稳定 ， 所以 这种 行走 方案 能 得到 广泛 运用 。 以六足 机器 人为 例 ， 组成 六足 机器 人 基本平台 的 部件 包括 ： 18 个 舵机 （ 机器 人 关节 ） ， 全身 肢体 结构 ， 动力 （ 大 电流 放电 电池 如 航模 电池 ） ， 航模 电池 平衡 充和 充电器 一个 ， 舵机 控制板 一个 （ 至少 18 路 ） ， 还有 一个 作为 自 主控制 或 外部 扩展 的 主控板 （ 也 就是 各种 单片机 最小 系统 板 和 开发板 ） 和 配套 下载 模块 简单 来说 ， 舵机 控制板 就是 机器 人 的 中枢神经 ， 负责 动作 协调 ， 另外 的 机器 人 主控 就是 大 脑 ， 负责 处理 外界 信息 ， 统一指挥 ， 机器 人 扩展 的 传感器 就是 感官 系统 ， 负责 接收 外界 信息 。 舵机 控制板 并 不是 机器 人 的 核心 ， 它 只是 负责 控制 舵机 的 模块 而已 ， 功能 再 多 也 只能 让 机器 人 跳跳舞 啥 的 ， 想 实现 机器 人 智能化 必须 要 添加 另外 的 主控 ， 也 就是 给 机器 人装个 大脑 ， 什么样 的 主控 呢 ： 大家 学 的 51 ， avr ， arm 单片机 都 可以 作为 机器 人 的 主控 ， 再 在 主控 上 添加 各种 传感器 模块 就 相当于 给 机器 人 安上 了 口 鼻耳 等等 ， 这样 便 初步 形成 了 机器 人 的 智能化 框架 普通 电机 ， 减速 电机 ， 步进电机 ， 伺服电机 的 区别 这里 讲 的 普通 电机 ， 步进电机 ， 伺服电机 指 的 是 直流电 的 微型 电机 ， 平常 我们 接触 到 的 也 以 直流电 的 居多 。 电机 的 学问 很深 ， 本文 只是 为 初学者 大致 讲 一下 制作 机器 人 常用 的 各种 电机 。 电机 ， 俗称 “ 马达 ” ， 是 指 依据 电磁感应 定律 实现 电能 的 转换 或 传递 的 一种 电磁 装置 。 电动机 也 称 （ 俗称 马达 ） ， 在 电路 中用 字母 “ m ” （ 旧 标准 用 “ d ” ） 表示 。 它 的 主要 作用 是 产生 驱动 转矩 ， 作为 用电器 或 各种 机械 的 动力源 ， 发电机 在 电路 中用 字母 “ g ” 表示 。 普通 直流电机 普通 电机 是 我们 平 时间 的 比 较 多 的 电机 ， 电动玩具 ， 刮胡刀 等 里面 都 有 。 一般 只有 两个 引脚 ， 用 电池 的 正负极 接上 两个 引脚 就 会 转 起来 ， 然后 电池 得 正负极 再 相反 的 接 在 两 引脚 上 电机 也 会 向 反转 。 这种 电机 有 转速 过快 ， 扭力 过 小 的 特点 ， 一般 不 直接 用 在 智能 小 车上 。 减速 电机 减速 电机 就是 普通 电机 加上 了 减速 箱 ， 这样 便 降低 了 转速 ， 增加 了 扭力 ， 使得 普通 电机 有 的 更 广泛 的 使用 空间 智能 小车 底盘 减速 电机 一般 都 是 用智能 小 车上 ， 而 对于 电机 的 控制 一般 都 用 h 桥 方案 ， l298 芯片 就是 这种 原理 。 而 调速 一般 采用 pwm （ 脉宽调制 ） 机制 ， 单片机 利用 定时器 控制 产生 占空比 可变 的 pwm 波 或者 直接 硬件 pwm 输出 不同 大小 的 波形 来 控制 小 车 整体 速度 。 步进电机 步进电机 是 将 电脉冲 信号 转变 为 角位移 或线 位移 的 开环控制 元 步进电机 件 。 在 非 超载 的 情况 下 ， 电机 的 转速 、 停止 的 位置 只 取决于 脉冲 信号 的 频率 和 脉冲数 ， 而 不受 负载 变化 的 影响 ， 当 步进 驱动器 接收 到 一个 脉冲 信号 ， 它 就 驱动 步进电机 按 设定 的 方向 转动 一个 固定 的 角度 ， 称为 “ 步距角 ” ， 它 的 旋转 是 以 固定 的 角度 一步 一步 运行 的 。 可以 通过 控制 脉冲 个数 来 控制 角位移 量 ， 从而 达到 准确 定位 的 目的 ； 同时 可以 通过 控制 脉冲频率 来 控制 电机 转动 的 速度 和 加速度 ， 从而 达到 调速 的 目的 。 收起 回复 | 11 楼 2013 - 12 - 10 11 : 26 : 舵机 用 的 就是 这种 吧 2014 - 5 - 410 : 22 : 步进电机 是 可以 控制 转向 角度 的 吗 ？ 能 不能 说 的 通俗 点 ？ 2014 - 11 - 2623 : 05 技惊 四座 9 舵机 和 伺服电机 舵机 主要 是 由 外壳 、 电路板 、 无 核心 马达 、 齿轮 与 位置检测器 所 构成 。 其 工作原理 是 由 接收机 发出 讯号 给 舵机 ， 经由 电路板 上 的 ic 判断 转动 方向 ， 再 驱动 无 核心 马达 开始 转动 ， 透过 减速 齿轮 将 动力 传至 摆臂 ， 同时 由 位置检测器 送回 讯号 ， 判断 是否 已经 到达 定位 。 位置检测器 其实 就是 可变电阻 ， 当 舵机 转动 时 电阻 也 会 随之 改变 ， 藉由 检测 电阻 便 可知 转动 的 角度 。 厂商 所 提供 的 舵机 规 资料 ， 都 会 包含 外形尺寸 ( mm ) 、 扭力 ( kg / cm ) 、 速度 ( 秒 / 60 ° ) 、 测试 电压 ( v ) 及 重量 ( g ) 等 基本 资料 。 扭力 的 单位 是 kg / cm ， 意思 是 在 摆臂 长度 1 公分 处 ， 能 吊起 几公斤 重 的 物体 。 这 就是 力臂 的 观念 ， 因此 摆臂 长度 愈长 ， 则 扭力 愈小 。 速度 的 单位 是 sec / 60 ° ， 意思 是 舵机 转动 60 ° 所 需要 的 时间 。 伺服电机 又 称 执行 电动机 ， 在 自动 控制系统 中 ， 用作 执行 元件 ， 把 所 收到 的 电信号 转换成 电动机 轴上 的 角位移 或 角速度 输出 。 分为 直流 和 交流 伺服 电动机 两大类 ， 其 主要 特点 是 ， 当 信号 电压 为 零时 无 自转 现象 ， 转速 随着 转矩 的 增加 而 匀速 下降 . 伺服 主要 靠 脉冲 来 定位 ， 基本上 可以 这样 理解 ， 伺服电机 接收 到 1 个 脉冲 ， 就 会 旋转 1 个 脉冲 对应 的 角度 ， 从而 实现 位移 ， 因为 ， 伺服电机 本身 具备 发 出脉冲 的 功能 ， 所以 伺服电机 每 旋转 一个 角度 ， 都 会 发出 对应 数量 的 脉冲 ， 这样 ， 和 伺服电机 接受 的 脉冲 形成 了 呼应 ， 或者 叫 闭环 ， 如此一来 ， 系统 就 会 知道 发了 多少 脉冲 给 伺服电机 ， 同时 又 收 了 多少 脉冲 回来 ， 这样 ， 就 能够 很 精确 的 控制 电机 的 转动 ， 从而 实现 精确 的 定位 ， 可以 达到 0.001 mm 。 直流 伺服电机 分为 有刷 和 无刷电机 。 有刷 电机 成本低 ， 结构 简单 ， 启动 转矩 大 ， 调速 范围 宽 ， 控制 容易 ， 需要 维护 ， 但 维护 不 方便 （ 换 碳刷 ） ， 产生 电磁干扰 ， 对 环境 有 要求 。 因此 它 可以 用于 对 成本 敏感 的 普通 工业 和 民用 场合 。 舵机 的 认识 和 选购 isobot 机器 人 玩具 和 不同 大小 的 舵机 sr403p 和 其他 舵机 直流 伺服电机 （ 舵机 ） 一般来讲 ， 舵机 主要 由 以下 几个 部分 组成 ， 舵盘 、 减速 齿轮 组 、 位置 反馈 电位 计 5k 、 直流电机 、 控制电路 板 等 普通 舵机 拆解 图 sr403p 拆解 图 工作原理 ： 控制电路 板 接受 来自 信号线 的 控制 信号 ， 控制 电机 转动 ， 电机 带动 一系列 齿轮 组 ， 减速 后 传动 至 输出 舵盘 。 舵机 的 输出 轴 和 位置 反馈 电位 计是 相连 的 ， 舵盘 转动 的 同时 ， 带动 位置 反馈 电位 计 ， 电位 计将 输出 一个 电压 信号 到 控制电路 板 ， 进行 反馈 ， 然后 控制电路 板 根据 所在位置 决定 电机 的 转动 方向 和 速度 ， 从而 达到目标 停止 。 舵机 的 控制 信号 为 周期 是 20ms 的 脉宽调制 （ pwm ） 信号 ， 其中 脉冲宽度 从 0.5 ms - 2.5 ms ， 相对 应 舵盘 的 位置 为 0 － 180 度 ， 呈 线性 变化 。 也就是说 ， 给 它 提供 一定 的 脉 宽 ， 它 的 输出 轴 就 会 保持 在 一个 相对 应 的 角度 上 ， 无论 外界 转矩 怎样 改变 ， 直到 给 它 提供 一个 另外 宽度 的 脉冲 信号 ， 它 才 会 改变 输出 角度 到 新 的 对应 的 位置 上 。 给 舵机 一个 位置 信号 ， 电机 就要 转动 ， 然后 带动 齿轮 组 ， 把 电位器 转 到 对应 角度 ， 然后 电机 停止 ， 相反 当有 外界 力量 干扰 这个 角度 ， 电位器 的 位置 就 会 改变 ， 舵机 内部 检测 电路 就 会 再 让 电机 重新 转动 ， 带动 齿轮 组把 电位器 转 到 信号 指令 位置 ， 然后 电机 再 停止 ， 但 电路 检测 一直 检测 电位器 没 到 指定 位置 ， 就 会 直接 让 电机 转动 ， 这样 噪声 就 产生 ， 而且 外界 干扰 力量 越大 ， 噪声 越大 ， 舵机 内部 电机 需要 的 电流 也 越 大 ， 如果 电流 大于 舵机 内部 电板 的 额定电流 ， 电板 就 烧 了 . 舵机 内部 有 一个 基准 电 路 ， 产生 周期 20ms ， 宽度 1.5 ms 的 基准 信号 ， 有 一个 比较器 ， 将 外加 信号 与 基准 信号 相比 较 ， 判断 出 方向 和 大小 ， 从而 产生 电机 的 转动 信号 。 由此可见 ， 舵机 是 一种 位置 伺服 的 驱动器 ， 转动 范围 不能 超过 180 度 ， 适用 于 那些 需要 角度 不断 变化 并 可以 保持 的 驱动 当中 。 比方说 机器 人 的 关节 、 飞机 的 舵面 等 。 下面 是 一段 舵机 测试代码 ， 采用 stc12c 系列 51 单片机 来 实现 舵机 控制 可以 制作 出来 当做 舵机 测试仪 # include stc12c5a60s2 . h / / # include stc12c2052ad . h # define stop 0 / / 宏 定义 ， 停止 # define left 1 / / 宏 定义 ， 左转 # define right 2 / / 宏 定义 ， 右转 sbit controlport = p1 ^ 0 ; / / 舵机 信号 端口 sbit keyleft = p1 ^ 1 ; / / 左转 按键 端口 sbit keyright = p1 ^ 2 ; / / 右转 按键 端口 sbit keystop = p1 ^ 3 ; / / 归位 按键 端口 unsigned char timeoutcounter = 0 , leftorright = 0 ; / / timeoutcounter ： 定时器 溢出 计数 leftorright ： 舵机 左右 旋转 标志 / / [ 定时 / 计数器 函数 ] / * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 名称 ： 定时器 0 初始化 功能 ： 20ms 定时 , 11.0592 m 晶振 初 = 65536 - 11059200 * 0.02 / 12 = 65536 - 18432 = 47104 = 0xb800 20ms 初 = 65536 - 11059200 * 0.0001 / 12 = 65536 - 92.16 = 64430 = 0xffa3 0.1 ms * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * / / * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 名称 ： 定时器 0 初始化 功能 ： 20ms 定时 , 12m 晶振 初 = 65536 - 12000000 * 0.02 / 12 = 65536 - 20000 = 45536 = 0xb1e0 20ms 初 = 65536 - 12000000 * 0.0001 / 12 = 65536 - 100 = 65436 = 0xff9c 0.1 ms * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * / / * tttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt 函数 名 ： 定时 / 计数器 初始化 函数 调 用 ： t _ c _ init ( ) ; 参 数 ： 无 返回 ： 无结 果 ： 设置 sfr 中 t / c1 和 （ 或 ） t / c0 相关 参数 备 注 ： 本 函数 控制 t / c1 和 t / c0 ， 不 需要 使用 的 部分 可用 / / 屏蔽 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - m1 m0 方式 说明 0 0 0 13 位 t / c ， 由 tl 低 5 位 和 th 的 8 位 组成 13 位 计数器 0 1 1 16 位 t / c ， tl 和 th 共 16 位 计数器 1 0 2 8 位 t / c ， tl 用于 计数 ， 当 tl 溢出 时 将 th 中 的 自动 写入 tl1 1 3 两组 8 位 t / c - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - ttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttttt * / / * t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0 函数 名 ： 定时 / 计数器 0 中断处理 函数 调 用 ： [ t / c0 溢出 后 中断处理 ] 参 数 ： 无 返回 ： 无结 果 ： 重新 写入 16 位 计数 寄存器 初始 ， 处理 用户程序 备 注 ： 必须 允许中断 并 启动 t / c 本 函数 方可 有 效 ， 重新 写入 初需 和 t _ c _ init 函数 一致 t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0t0 * / void t _ c0 ( void ) interrupt 1 using 1 { / / 切换 寄存器 组到 1th0 = ( 65535 - 250 ) / 256 ; tl0 = ( 65535 - 250 ) % 256 ; timeoutcounter ; switch ( leftorright ) { case 0 : / / 为 0 时 ， 舵机 归位 ， 脉 宽 1.5 ms { if ( timeoutcounter = 6 ) { controlport = 1 ; } else { controlport = 0 ; } break ; } case 1 : / / 为 1 时 ， 舵机 左转 ， 脉 宽 1ms （ 理论 ） ， 实际 可以 调试 得出 { if ( timeoutcounter = 2 ) { controlport = 1 ; } else { controlport = 0 ; } break ; } case 2 : / / 为 2 时 ， 舵机 右转 ， 脉 宽 2ms （ 理论 ） ， 实际 可以 调试 得出 { if ( timeoutcounter = 10 ) { controlport = 1 ; } else { controlport = 0 ; } break ; } default : break ; } if ( timeoutcounter = = 80 ) / / 周期 20ms （ 理论 ） ， 比 较 可靠 ， 最好 不要 修改 { timeoutcounter = 0 ; } / / 函数 内容 } 舵机 的 输入 线 共有 三条 ， 红色 中间 ， 是 电源线 ， 一边 黑色 的 是 地线 ， 这辆 根线 给 舵机 提供 最 基本 的 能源 保证 ， 主要 是 电机 的 转动 消耗 。 电源 有 两种 规 ， 一是 4.8 v ， 一是 6.0 v ， 分别 对应 不同 的 转矩 标准 ， 即 输出 力矩 不同 ， 6.0 v 对应 的 要 大 一些 ， 具体 看 应用 条件 ； 另外 一根 线 是 控制 信号线 ， futaba 的 一般 为 白色 ， jr 的 一般 为 桔黄色 。 另外 要 注意 一点 ， sanwa 的 某些 型号 的 舵机 引线 电源线 在 边上 而 不是 中间 ， 需要 辨认 。 但 记住 红色 为 电源 ， 黑色 为 地线 ， 一般 不会 搞错 。 厂商 所 提供 的 舵机 规 资料 ， 都 会 包含 外形尺寸 ( mm ) 、 扭力 ( kg / cm ) 、 速度 ( 秒 / 60 ° ) 、 测试 电压 ( v ) 及 重量 ( g ) 等 基本 资料 。 扭力 的 单位 是 kg / cm ， 意思 是 在 摆臂 长度 1 公分 处 ， 能 吊起 几公斤 重 的 物体 。 这 就是 力臂 的 观念 ， 因此 摆臂 长度 愈长 ， 则 扭力 愈小 。 速度 的 单位 是 sec / 60 ° ， 意思 是 舵机 转动 60 ° 所 需要 的 时间 。 电压 会 直接 影响 舵机 的 性能 ， 例如 futaba s - 9001 在 4.8 v 时 扭力 为 3.9 kg / cm 、 速度 为 0.22 秒 / 60 ° ， 在 6.0 v 时 扭力 为 5.2 kg / cm 、 速度 为 0.18 秒 / 60 ° 。 若 无 特别 注明 ， jr 的 舵机 都 是 以 4.8 v 为 测试 电压 ， futaba 则 是 以 6.0 v 作为 测试 电压 。 速度 快 、 扭力 大 的 舵机 ， 除了 价贵 ， 还会 伴随 著高 耗电 的 特点 。 因此 使用 高级 的 舵机 时 ， 务必 搭配 高品质 、 高容量 的 电池 ， 能 提供 稳定 且 充裕 的 电流 ， 才 可 发挥 舵机 应有 的 性能 。 数码 舵机 常见问题 原理 分析 及 解决 ： 一 、 数码 舵机 与 模拟 舵机 的 区别 传统 模拟 舵机 和 数字 比例 舵机 （ 或 称之为 标准 舵机 ） 的 电子电路 中 无 mcu 微控制器 ， 一般 都 称之为 模拟 舵机 。 老式 模拟 舵机 由 功率 运算 放大器 等 接成惠 斯登 电桥 ， 根据 接收 到 模拟 电压 控制指令 和 机械 连动 位置传感器 （ 电位器 ） 反馈 电压 之间 比 较 产生 的 差分 电压 ， 驱动 有刷 直流电机 伺服电机 正 / 反 运转 到 指定 位置 。 数字 比例 舵机 是 模拟 舵机 最好 的 类型 ， 由 直流 伺服电机 、 直流 伺服电机 控制器 集成电路 ( ic ) ， 减速 齿轮 组和 反馈 电位器 组成 ， 它 由 直流 伺服电机 控制 芯片 直接 接收 pwm （ 脉冲 方波 ， 一般 周期 为 20ms ， 脉 宽 1 ~ 2 ms ， 脉 宽 1 ms 为 上限 位置 ， 1.5 ms 为 中位 , 2ms 为 下限 位置 ） 形式 的 控制驱动 信号 ， 迅速 驱动 电机 执行 位置 输出 , 直至 直流 伺服电机 控制 芯片 检测 到 位置 输出 连动 电位器 送来 的 反馈 电压 与 pwm 控制驱动 信号 的 平均 有 效 电压 相等 , 停止 电机 ， 完成 位置 输出 。 数码 舵机 电子电路 中带 mcu 微控制器 故 俗称 为 数码 舵机 ， 数码 舵机 凭借 比 之 模拟 舵机 具有 反应速度 更 快 ， 无 反应 区 范围 小 ， 定位精度 高 ， 抗干扰能力 强 等 优势 已 逐渐 取代 模拟 舵机 在 机器 人 、 航模 中 得到 广泛应用 。 数码 舵机 设计方案 一般 有 两种 ： 一种 是 mcu 直流 伺服电机 直流 伺服电机 控制器 集成电路 ( ic ) 减速 齿轮 组 反馈 电位器 的 方案 ， 以下 称为 方案 1 ， 另 一种 是 mcu 直流 伺服电机 减速 齿轮 组 反馈 电位器 的 方案 ， 以下 称为 方案 2 。 市面上 加装 数码 驱动 板 把 模拟 舵机 改 数码 舵机 属 方案 1 二 、 舵 机电 机 调速 原理 及 如何 加快 电机 速度 常见 舵 机电 机 一般 都 为 永磁 直流电 动机 ， 如 直流 有刷 空心 杯 电机 。 直流电 动机 有 线形 的 转速 - 转矩 特性 和 转矩 - 电流 特性 ， 可控性 好 ， 驱动 和 控制电路 简单 ， 驱动 控制 有电 流控制 模式 和 电压 控制 两种 模式 。 舵 机电 机 控制 实行 的 是 电压 控制 模式 ， 即 转速 与 所 施加 电压 成正比 ， 驱动 是 由 四个 功率 开关 组成 h 桥电路 的 双 极性 驱动 方式 ， 运用 脉冲宽度 调制 （ pwm ） 技术 调节 供给 直流电 动机 的 电压 大小 和 极性 ， 实现 对 电动机 的 速度 和 旋转 方向 （ 正 / 反转 ） 的 控制 。 电机 的 速度 取决于 施加 到 在 电机 平均 电压 大小 ， 即 取决于 pwm 驱动 波形 占空比 （ 占空比 为脉 宽 / 周期 的 百分比 ） 的 大小 ， 加大 占空比 ， 电机 加速 ， 减少 占空比 电机 减速 。 所以 要 加快 电机 速度 ： 1 、 加大 电机 工作电压 ； 2 、 降低 电 机主 回路 阻 ， 加大 电流 ； 二者 在 舵机 设计 中要 实现 ， 均 涉及 在 满足 负载 转矩 要求 情况 下 重新 选择 舵 机电 机 。 三 、 数码 舵机 的 反应速度 为何 比 模拟 舵机 快 很多 模友 错误 以为 ： “ 数码 舵机 的 pwm 驱动 频率 300hz 比 模拟 舵机 的 50hz 高 6 倍 ， 则 舵 机电 机 转速 快 6 倍 ， 所以 数码 舵机 的 反应速度 就 比 模拟 舵机 快 6 倍 ” 。 这里 请 大家 注意 占空比 的 概念 ， 脉 宽 为 每周 期有效 电平 时间 ， 占空比 为脉 宽 / 周期 的 百分比 ， 所以 大小 与 频率 无关 。 占空比 决定 施加 在 电 机上 的 电压 ， 在 负载 转矩 不变 时 ， 就 决定 电机 转速 ， 与 pwm 的 频率 无关 。 模拟 舵机 是 直流 伺服电机 控制器 芯片 一般 只能 接收 50hz 频率 （ 周期 20ms ） ~ 300hz 左右 的 pwm 外部 控制 信号 ， 太高 的 频率 就 无法 正常 工作 了 。 若 pwm 外部 控制 信号 为 50hz ， 则 直流 伺服电机 控制器 芯片 获得 位置 信息 的 分辨时间 就是 20ms ， 比较 pwm 控制 信号 正比 的 电压 与 反馈 电位器 电压 得 出差 , 该差 经脉 宽 扩展 ( 占空比 改变 , 改变 大小 正比 于 差 ) 后 驱动 电机 动作 ， 也就是说 由于 受 pwm 外部 控制 信号 频率 限制 ， 最快 20ms 才能 对 舵机 摇臂 位置 做 新 的 调整 。 数码 舵机 通过 mcu 可以 接收 比 50hz 频率 （ 周期 20ms ） 快得多 的 pwm 外部 控制 信号 ， 就 可 在 更 短 的 时间 分辨 出 pwm 外部 控制 信号 的 位置 信息 ， 计算 出 pwm 信号 占空比 正比 的 电压 与 反馈 电位器 电压 的 差 ， 去 驱动 电机 动作 ， 做 舵机 摇臂 位置 最新 调整 。 结论 ： 不管 是 模拟 还是 数码 舵机 ， 在 负载 转矩 不变 时 ， 电机 转速 取决于 驱动 信号 占空比 大小 而 与 频率 无关 。 数码 舵机 可 接收 更 高频率 的 pwm 外部 控制 信号 ， 可 在 更 短 的 周期时间 后 获得 位置 信息 ， 对 舵机 摇臂 位置 做 最新 调整 。 所以 说 数码 舵机 的 反应速度 比 模拟 舵机 快 ， 而 不是 驱动 电机 转速比 模拟 舵机 快 。 四 、 数码 舵机 的 无 反应 区 范围 为何 比 模拟 舵机 小 根据上述 对 模拟 舵机 的 分析 可知 模拟 舵机 约 20ms 才能 做 一次 新 调整 。 而 数码 舵机 以 更 高频率 的 pwm 驱动 电机 。 pwm 频率 的 加快 使 电机 的 启动 / 停止 ， 加 / 减速 更 柔和 ， 更 平滑 ， 更 有效 的 为 电机 提供 启动 所 需 的 转矩 。 就 象是 汽车 获得 了 更 小 的 油门 控制区 间 ， 则 启动 / 停止 ， 加 / 减速 性 能 更好 。 所以 数码 舵机 的 无 反应 区 比 模拟 舵机 小 。 五 、 模拟 舵机 加装 数码 舵机 驱动 板 并未 提升 反应速度 根据 以上 分析 可知 ， 模拟 舵机 加装 数码 舵机 驱动 板 ， 要 提升 反应速度 ， pmw 外部 控制 信号 （ 如 陀螺仪 送来 的 尾 舵机 信号 ） 的 频率 必须 加快 ， 如果 还是 50hz ， 那 舵机 反应速度 当然 就 没 提升 了 。 六 、 舵机 控制 死 区 、 滞环 、 定位精度 、 输入 信号 分辨率 、 回 中性 能 的 认识 每 一个 闭环 控制系统 由于 信号 的 振荡 等 原因 ， 输入 信号 和 反馈 信号 不 可能 完全 相等 ， 这 就 涉及 到 控制 死区 和 滞环 的 问题 ， 系统 无法 辨别 输入 信号 和 反馈 信号 的 差异 范围 就是 控制 死 区 范围 。 舵机 自动 控制系统 由于 信号 震荡 、 机械 精度 等 原因 造成 控制系统 在 控制 死 区 范围 外 的 小 范围 老是 做 调整 ， 为 使 舵机 在 小 范围 内 不 对 震荡 做 调整 ， 这 就 需要 引入 滞环 的 作用 了 。 滞 环比 控制 死区 大 ， 一般 控制 死 区 范围 为 ± 0.4 % ， 滞环 可 设置 为 ± 2 % ， 输入 信号 和 反馈 信号 的 差 在 滞 环内 电机 不 动作 ， 输入 信号 和 反馈 信号 的 差 进入 滞环 ， 电机 开始 制动 - 停止 。 定位精度 取决于 舵 机系统 的 整体 精度 ： 如 控制 死 区 、 机械 精度 、 反馈 电位器 精度 、 输入 信号 分辨率 。 输入 信号 分辨率 指 舵机 系统对 输入 信号 最小 分辨 范围 ， 数码 舵机 输入 信号 分辨率 大大 优于 模拟 舵机 。 回 中性 能 取决于 滞环 和 定位精度 。 七 、 舵机 为何 会 老 发出 吱吱 的 响声 舵机 老 发出 吱吱 的 来回 定位 调整 响声 ， 是 由于 有 的 舵机 无滞 环 调节 功能 ， 控制 死 区 范围 调得 小 ， 只要 输入 信号 和 反馈 信号 老是 波动 ， 它们 的 差 超出 控制 死 区 ， 舵机 就 发出信号 驱动 电机 。 另 没有 滞环 调节 功能 ， 如果 舵机 齿轮 组 机械 精度 差 ， 齿 虚位 大 ， 带动 反馈 电位器 的 旋转 步 ， 步 范围 就 已 超出 控制 死 区 范围 ， 那 舵机 必将 调整 不停 ， 吱吱 不停 。 八 、 为何 有 的 舵机 炸机易 烧 电路板 有 的 舵机 选用 的 功率 器件 电流 大 同时 系统 中 设计 有 或 芯片 自带 有 过流 保护 功能 ， 能 检测 出堵 转过 流及 短路 状态 迅速 停止 电机 驱动 信号 。 还有 可 在 电机 回路 接 压敏电阻 防止 瞬间 过压 及 在 功率 器件 前端 设计 有 吸收 电容 。 此类 舵机 炸机 堵 转 不 容易 烧 电路板 和 电机 。 与 舵机 是 金属 齿 还是 塑料 齿 并 无 绝对 关系 。 九 、 舵机 为何 抖 舵 控制 死 区 敏感 ， 输入 信号 和 反馈 信号 因 各种 原因 波动 ， 差 超出范围 ， 舵臂动 ， 所以 抖 舵 。 十一 、 舵机 为何 抖 舵 控制 死 区 敏感 ， 输入 信号 和 反馈 信号 因 各种 原因 波动 ， 差 超出范围 ， 舵臂动 ， 所以 抖 舵 。 舵机 一般 故障 判断 ： 1 ） 炸机 后 舵 机电 机 狂转 、 舵盘 摇臂 不 受控 制 、 摇臂 打滑 - - - - - - - - - - - - - - - - - - 可以 断定 ： 齿轮 扫齿 了 ， 换 齿轮 。 2 ） 炸机 后 舵机 一致性 锐减 ， 现象 是 炸坏 的 舵机 反应迟钝 ， 发热 严重 ， 但是 可以 随着 控 的 指令 运行 ， 但是 舵量 很小 很 慢 - - - - - - - - - - - - - 基本 断定 ： 舵 机电 机过 流 了 ， 拆 下 电机 后 发现 电机 空载 电流 很大 （ 150ma ） ， 失去 完好 的 性能 ( 完好 电机 空载 电流 ≤ 60 - 90ma ) ， 换 舵 机电 机 。 3 ） 炸机 后 舵机 打舵后 无 任何 反应 - - - - - - - - - - - - - - - 基本 确定 舵 机电 子 回路 断路 、 接触不良 或 舵机 的 电机 、 电路板 的 驱动 部分 烧毁 导致 的 ， 先 检查 线路 ， 包括 插头 ， 电机 引线 和 舵机 引线 是否 有 断路 现象 ， 如果 没有 的话 ， 就 进行 逐一 排除 ， 先 将 电机 卸下 测试 空载 电流 ， 如果 空载 电流 小于 90ma ， 则 说明 电机 是 好 的 ， 那 问题 绝对 是 舵机 驱动 烧坏 了 ， 9 - 13 克 微型 舵机 电路板 上面 就 有 2 个 或 四个 小 贴片 三极管 ， 换掉 就 可以 了 ， 有 2 个 三极管 的 那 肯定 是 用 y2 或 iy 直接 代换 ， 也 就是 ss8550 ， 如果 是 有 四个 三极管 的 h 桥电路 ， 则 直接 用 2 个 y1 （ ss8050 ） 和 2 个 ( ss8550 ) 直接 代换 ， 65mg 的 uyr - - - - 用 y 1 ( ss8050 ic = 1.5 a ) ; uxr - - - - - - 用 y2 （ ss8550 ， ic = 1.5 a ） 直接 代换 。 4 ） 舵机 故障 是 摇臂 只能 一边 转动 ， 另外 一边 不 动 的话 - - - - - - - - - - - 判断 ： 舵 机电 机是 好 的 ， 主要 检查 驱动 部分 ， 有 可能 烧 了 一边 的 驱动 三极管 ， 按照 （ 3 ） 维修 即可 。 5 ） 维修 好 舵机 后 通电 ， 发现 舵机 向 一个 方向 转动 后 就 卡住 不动 了 ， 舵机 吱吱 地响 - - - - - - - - - - - - - - 说明 舵 机电 机 的 正负极 或 电位器 的 端线 接错 了 ， 电机 的 两个 接线 倒个 方向 就 可以 了 。 6 ） 崭新 的 舵机 买回来 后 ， 通电 发现 舵机 狂抖 ， 但用 一下 控 的 摇臂 后 ， 舵机 一切正常 - - - - - - - - - - 说明 舵机 在 出厂 的 时候 装配 不当 或 齿轮 精度 不够 ， 这个 故障 一般 发生 在 金属 舵机 上面 ， 如果 不想 退货 或者 更换 的话 ， 自行解决 的 方法 ： 卸下 舵机 后盖 ， 将 舵 机电 机与 舵机 减速 齿轮 分离 后 ， 在 齿轮 之间 挤点 牙膏 ， 上 好 舵机 齿轮 顶盖 ， 上 好 减速 箱 螺丝 后 ， 安上 舵机 摇臂 ， 用手 反复 旋转 摇臂 碾磨 金属 舵机 齿轮 ， 直至 齿轮 运转 顺滑 、 齿轮 摩擦 噪音 减小 后 ， 将 舵机 齿轮 卸下 汽油 清洗 后 ， 装 齿轮 上 硅油 组装 好 舵机 ， 即可 解决 舵机 故障 。 7 ） 有 一种 故障 舵机 表现 很 古怪 ： 摇动 控 的 遥感 ， 舵机 有 正常 的 反应 ， 但是 固定 控 的 遥感 某一 位置 后 ， 故障 舵机 摇臂 还 在 慢慢 的 运行 ， 或者 摇臂 动作 拖泥带水 ， 并 来回 动作 - - - - - - - - - - - - - - - - - - 经过 多次 维修 后 发现 问题所在 ： 应该 紧密 卡 在 舵机 末级 齿轮 中 电位器 的 金属 转柄 ， 与 舵机 摇臂 大 齿轮 （ 末级 ） 结合 不紧 ， 甚至 发生 打滑 现象 ， 导致 舵机 无法 正确 寻找 控 发出 的 位置 指令 ， 反馈 不准 ， 不停 寻找 导致 的 ， 解决 了 电位器 与 摇臂 齿轮 的 紧密结合 后 ， 故障 可以 排除 。 按照 改方法 检修 后 故障 仍旧 存在 的话 ， 也 有 可能 是 舵 机电 机 的 问题 或 电位器 的 问题 ， 需要 综合 分析 逐一 排查 ！ 8 ） 故障 舵机 不停 的 抖 舵 ， 排除 无线电 干扰 ， 动控 摇臂 仍旧 抖动 的话 - - - - - - - - - - 电位器 老化 ， 换 之 ， 或 直接 报 废掉 ， 当 配件 ！ 9 ） 数码 斜盘 舵机 装机 过后 发现 舵机 运行 不 正常 ， 快慢 不 一 ， 退回 厂家 ， 后来 换回 3 个 后 还是 一致性 差 ， 最后 才 知道 是 什么 原因 - - - - - 有些 数码 舵机 对 bec 要求 ， 加装 5 . v3a 外置 bec 后 ， 故障 排除 ， 与 舵机 质量 无关 。 舵机 选购 ： 市 场上 的 舵机 有 塑料 齿 、 金属 齿 、 小 尺寸 、 标准 尺寸 、 大 尺寸 ， 另外 还有 薄 的 标准 尺寸 舵机 ， 及 低 重心 的 型号 。 小 舵机 一般 称为 微型 舵机 ， 扭力 都 比 较 小 ， 市面上 2.5 g ， 3.7 g ， 4 . 4g ， 7g ， 9g 等 舵机 指 的 是 舵机 的 重量 分别 是 多少 克 ， 体积 和 扭力 也 是 逐渐 增大 。 微型 舵机 内部 多数 都 是 塑料 齿 ， 9g 舵机 有 金属 齿 的 型号 ， 扭力 也 比 塑料 齿 的 要 大些 。 futaba s3003 ， 辉盛 mg995 是 标准 舵机 ， 体积 差不多 ， 但 前者 是 塑料 齿 ， 后者 金属 齿 ， 两者 标称 的 扭力 也 差 很多 。 春天 sr403p ， dynamixel ax - 12 是 机器 人 专用 舵机 ， 不同 的 是 前者 是 国产 ， 后者 是 韩国 产 ， 两者 都 是 金属 齿 标称 扭力 13kg 以上 ， 但 前者 只是 改改 样子 的 模拟 舵机 ， 后者 则 是 rs485 串口 通信 ， 具有 位置 反馈 ， 而且 还 具有 速度 反馈 与 温度 反馈 功能 的 数字 舵机 ， 两者 在 性能 和 价上 相差 很大 。 除了 体积 ， 外形 和 扭力 的 不同 选择 ， 舵机 的 反应速度 和 虚位 也 要 考虑 ， 一般 舵机 的 标称 反应速度 常见 0.22 秒 / 60 ° ， 0.18 秒 / 60 ° ， 好些 的 舵机 有 0.12 秒 / 60 ° 等 的 ， 数小 反应 就 快 。 舵机 虚位 产生 和 舵机 的 扭力 和 制造 工艺 有关 ， 扭力 大 相应 的 负载 范围 也 大 ， 虚位 就 相应 小 ， 普通 舵机 新 的 时候 虚位 一般 比较 小 , 也 就是 半个 齿 的 角度 , 这个 应该 是 机械加工 的 精度问题 , 好 的 舵机 就 比 较 小 。 但 使用 了 一段时间 以后 ， 尤其 是 大 扭距 的 舵机 ， 虚位 就 越来越 大 了 ， 这个 应该 不是 齿轮 磨损 造成 的 ， 解剖 了 几个 舵机 ， 发现 都 是 舵机 盖 的 塑料 材质 不够 硬 ， 齿轮 的 的 轴 都 是 直接 装在 这个 塑料盖 上 的 ， 时间 一长 ， 这 几个 孔 都 被 扩大 成 椭圆形 了 。 一 扳 摇臂 ， 齿轮 的 轴 就 会 左右 晃动 ， 虚位 就 产生 了 。 现在 市面上 的 舵机 鱼龙混杂 ， 总体 来说 仿品 不如 正品 ， 便宜 的 不如 贵 的 ， 塑料 齿 的 不如 金属 齿 的 ， 老 的 不如 新 的 ， 国内 的 不如 外国 的 等等 ， 大家 不必 过于 追求 极致 ， 根据 自身 购买力 选择 够用 的 就 行 。 动力 的 分析 六足 机器 人 采用 了 18 个 作为 关节 件 ， 通过 之前 对 舵机 的 介绍 我们 知道 舵机 是 由 直流电机 ， 减速 齿轮 组 ， 与 相应 控制 电板 组成 ， 舵机 里 的 耗电 大户 就是 直流电机 。 9g 舵机 里 的 直流电机 耗电量 相对 标准 舵机 里 的 要 小 ， 但 18 个 舵机 加 起来 仍然 是 很 惊人 的 。 9g 舵机 里 的 电机 静载 电流 应该 在 100ma 至 150ma ， 而 负载 时 电流 会 增大 到 500ma 至 600ma 之间 。 这样 18 个 舵机 的 电流 需求 范围 大概 就是 2a 至 10a 左右 。 作为 动力 的 来源 一般 分为 两种 ， 一种 是 转换 市电 的 电源 ， 一种 就是 自储电 的 电池 。 电源 又 可以 分 和 两种 ， 线性 电源 是 先 将 交流电 经过 降低 电压 幅 ， 再 经过 整流 后 ， 得到 脉冲 直流电 ， 后经 滤波 得到 带有 微小 波纹 电压 的 直流电 压 。 要 达到 高精度 的 直流电 压 ， 必须 经过 进行 稳压 。 开关电源 是 利用 现代 电力 电子技术 ， 控制 开关 管 开通 和 关断 的 时间 比率 ， 维持 稳定 输出 电压 的 一种 电源 ， 开关电源 一般 由 脉冲宽度 调制 （ pwm ） 控制 ic 和 mosfet 构成 。 简单 来说 ， 我们 常用 的 电源 一般 都 是 ， 体积小 ， 价 便宜 ， 但 普遍 输出功率 不 大 ， 电流 很小 ， 一般 为 几百 ma 至 几 a ， 达 不到 机器 人 的 供电 要求 。 而 可以 很 轻易 地 进行 高功率 稳定 输出 ， 电流 一般 在 几 a 至 上百 a ， 足够 机器 人 供电 使用 。 电池 种类 有 很多 ， ， ， 镍 镉 ， ， 锂电池 等等 ， 干电池 的 放电 电流 小 ， 可以 供电 一两个 ， 但 多 了 就 不行 了 。 铅 蓄电池 可以 提供 大 电流 放电 ， 但 体积 比 较大 ， 不 适合 小型 机器 人 携带 。 市面 常用 的 镍 镉 ， 镍氢电池 放电 电流 跟 干电池 一样 ， 电流 偏小 ， 但 也 有 模型 厂商 生产 大 电流 放电 的 镍 镉 ， 镍氢电池 ， 体积 跟 干电池 差不多 ， 可以 用 在 机器 人 身上 。 锂电池 可以 分为 锂 金属 电池 和 ， 锂 金属 电池 由于 危险性 大 ， 很少 应用 于 日常 电子产品 ， 而 锂离子 电池 则 在生活中 使用 广泛 ， 比如 和 。 锂离子 电池 又 分 两种 ， 液 锂电池 ( li - ion ) 和 （ ) ， 液 锂电池 的 形状 类 ， 圆柱形 ， 单节 电压 标称 , 笔记本 电池 还有 现在 比较 火 的 户外 强光 led 手电 用 的 都 是 这种 。 而 锂 聚合物 电池 在 形状 上 没有 特别 规定 ， 一般 是 按 电子产品 的 体积 需求 而 定制 ， 常见 的 形状 就是 扁长 形 ， 有 正负 金属电极 引出 ， 手机电池 就是 这种 。 日常 应用 的 电子产品 内部 的 锂离子 电池 同样 也 是 小 电流 输出 ， 而用 在 特殊 模型 上 的 锂离子 电池 就是 大 电流 输出 了 ， 比如 航模 ， 车模 。 所以 给 机器 人 选择 供电 ， 不管 什么 电池 ， 首要条件 就是 要 看 电池 的 放电 电流 大不大 ， 能 不能 达到 机器 人 的 供电 要求 。 这里 需要 普及 一下 放电 倍率 的 知识 ： 电池 的 c 表示 电池 的 放电 率 （ 电池 放电 倍率 的 简称 ） ； 比如 一个 电池 是 1000mah 的 容量 ， c 是 15c ， 那么 它 最大 放电 电流 就是 1ax15 = 15a 。 大家 在 选择 电池 的 时候 可以 计算 一下 ， 看看 适不 适合 使用 。 关于 机器 人 的 供电 电压 也 要说 一下 ， 机器 人 使用 的 一般 标称 6v 电压 ， 这个 标称 电压 实际 并 不 准确 ， 只是 说明 了 舵机 在 这个 电压 左右 能 达到 性能 和 烧毁 几率 的 平衡性 。 各种 大 电流 放电 的 充电电池 实际 电压 都 会 高于 这个 标称 电压 ， 比如 模型 用 的 标称 6v 组 实际 充满 会 在 7v 左右 ， 而 模型 用 的 标称 7.4 v 的 组 充满 会 在 8.4 v 左右 。 需要 降压 到 6v 左右 才能 供 机器 人 使用 ， 降压 需要 降压 模块 ， 比如 7805 ， lm2596 芯片 的 dc - dc 直 流转 直流 降压 模块 等等 ， 但 这些 降压 模块 的 输出 电流 普遍 偏小 ， 要 选择 大 电流 输出 的 降压 模块 才行 ， 或者 就是 几个 小 电流 的 降压 模块 并 连在一起 扩流 使用 。 还 一种 方 法 就是 利用 二极管 来 降压 ， 比如 一个 1n4007 测试 可以 降 0.3 v ， 但 一个 二极管 通过 电流 偏小 ， 虽然 标称 1a ， 实际 在 500ma 电流 时 发热量 就 很大 了 ， 所以 要 多个 1n4007 并联 然后 再 串联 多组 ， 然后 接到 电池 上 才能 既 降压 又 能 大 电流 输出 。 这是 麻烦 的 方法 ， 简单 的 就 可以 直接 使用 大功率 整流桥 ， 整流桥 的 内部 是 多个 二极管 交叉 串并联 ， 只 需 选择 一组 就行 ， 比如 d25xb80 整流桥 ， 标称 25a 的 额定电流 ， 实际 接 电池 使用 时 发热量 很小 ， 锂电 组 充满 8.4 v 接 一片 d25xb80 18 个 整体 压降 可以 到 6.9 v ， 接 两片 可以 降到 6.5 v ， 稍高于 6v 使用 上 没有 问题 。 这里 补充 一下 ， 整流桥 就是 整流桥 ， 它 不会 神奇 的 变成 一个 高级 的 降压 器件 ， 在 这个 整体 电路 里 是 利用 它 在 整体 电路 中 发挥 通过 电流 大 ， 物理 减压 ， 限流 的 特点 而 使用 的 。 （ 分析 问题 请 结合 上下文 ， 考虑 整体性 ） 最后 要 强调 一下 ： 最近 发现 大家 都 喜欢 直接 用电 脑 的 usb 供电 来 测试 和 舵机 板 ， 这样 是 绝对 不行 的 。 舵机 的 电流 需求 比 较大 ， 即使 是 9g 的 小 舵机 ， 电流 需求 也 比 usb 的 500ma 电流 要 大 ， usb 可以 给 一个 舵机 供电 ， 但 你 会 发现 转 起来 比较慢 ， 这 就是 供电 不足 ， 同时 usb 的 电压 也 被 拉 低 了 ， 如果 再多接 几个 舵机 ， 要么 烧 舵机 板 ， 要么 烧 电脑 的 usb 电板 。 动力 的 分析 六足 机器 人 采用 了 18 个 作为 关节 件 ， 通过 之前 对 舵机 的 介绍 我们 知道 舵机 是 由 直流电机 ， 减速 齿轮 组 ， 与 相应 控制 电板 组成 ， 舵机 里 的 耗电 大户 就是 直流电机 。 9g 舵机 里 的 直流电机 耗电量 相对 标准 舵机 里 的 要 小 ， 但 18 个 舵机 加 起来 仍然 是 很 惊人 的 。 9g 舵机 里 的 电机 静载 电流 应该 在 100ma 至 150ma ， 而 负载 时 电流 会 增大 到 500ma 至 600ma 之间 。 这样 18 个 舵机 的 电流 需求 范围 大概 就是 2a 至 10a 左右 。 作为 动力 的 来源 一般 分为 两种 ， 一种 是 转换 市电 的 电源 ， 一种 就是 自储电 的 电池 。 电源 又 可以 分 和 两种 ， 线性 电源 是 先 将 交流电 经过 降低 电压 幅 ， 再 经过 整流 后 ， 得到 脉冲 直流电 ， 后经 滤波 得到 带有 微小 波纹 电压 的 直流电 压 。 要 达到 高精度 的 直流电 压 ， 必须 经过 进行 稳压 。 开关电源 是 利用 现代 电力 电子技术 ， 控制 开关 管 开通 和 关断 的 时间 比率 ， 维持 稳定 输出 电压 的 一种 电源 ， 开关电源 一般 由 脉冲宽度 调制 （ pwm ） 控制 ic 和 mosfet 构成 。 简单 来说 ， 我们 常用 的 电源 一般 都 是 ， 体积小 ， 价 便宜 ， 但 普遍 输出功率 不 大 ， 电流 很小 ， 一般 为 几百 ma 至 几 a ， 达 不到 机器 人 的 供电 要求 。 而 可以 很 轻易 地 进行 高功率 稳定 输出 ， 电流 一般 在 几 a 至 上百 a ， 足够 机器 人 供电 使用 。 电池 种类 有 很多 ， ， ， 镍 镉 ， ， 锂电池 等等 ， 干电池 的 放电 电流 小 ， 可以 供电 一两个 ， 但 多 了 就 不行 了 。 铅 蓄电池 可以 提供 大 电流 放电 ， 但 体积 比 较大 ， 不 适合 小型 机器 人 携带 。 市面 常用 的 镍 镉 ， 镍氢电池 放电 电流 跟 干电池 一样 ， 电流 偏小 ， 但 也 有 模型 厂商 生产 大 电流 放电 的 镍 镉 ， 镍氢电池 ， 体积 跟 干电池 差不多 ， 可以 用 在 机器 人 身上 。 锂电池 可以 分为 锂 金属 电池 和 ， 锂 金属 电池 由于 危险性 大 ， 很少 应用 于 日常 电子产品 ， 而 锂离子 电池 则 在生活中 使用 广泛 ， 比如 和 。 锂离子 电池 又 分 两种 ， 液 锂电池 ( li - ion ) 和 （ ) ， 液 锂电池 的 形状 类 ， 圆柱形 ， 单节 电压 标称 , 笔记本 电池 还有 现在 比较 火 的 户外 强光 led 手电 用 的 都 是 这种 。 而 锂 聚合物 电池 在 形状 上 没有 特别 规定 ， 一般 是 按 电子产品 的 体积 需求 而 定制 ， 常见 的 形状 就是 扁长 形 ， 有 正负 金属电极 引出 ， 手机电池 就是 这种 。 日常 应用 的 电子产品 内部 的 锂离子 电池 同样 也 是 小 电流 输出 ， 而用 在 特殊 模型 上 的 锂离子 电池 就是 大 电流 输出 了 ， 比如 航模 ， 车模 。 所以 给 机器 人 选择 供电 ， 不管 什么 电池 ， 首要条件 就是 要 看 电池 的 放电 电流 大不大 ， 能 不能 达到 机器 人 的 供电 要求 。 这里 需要 普及 一下 放电 倍率 的 知识 ： 电池 的 c 表示 电池 的 放电 率 （ 电池 放电 倍率 的 简称 ） ； 比如 一个 电池 是 1000mah 的 容量 ， c 是 15c ， 那么 它 最大 放电 电流 就是 1ax15 = 15a 。 大家 在 选择 电池 的 时候 可以 计算 一下 ， 看看 适不 适合 使用 。 关于 机器 人 的 供电 电压 也 要说 一下 ， 机器 人 使用 的 一般 标称 6v 电压 ， 这个 标称 电压 实际 并 不 准确 ， 只是 说明 了 舵机 在 这个 电压 左右 能 达到 性能 和 烧毁 几率 的 平衡性 。 各种 大 电流 放电 的 充电电池 实际 电压 都 会 高于 这个 标称 电压 ， 比如 模型 用 的 标称 6v 组 实际 充满 会 在 7v 左右 ， 而 模型 用 的 标称 7.4 v 的 组 充满 会 在 8.4 v 左右 。 需要 降压 到 6v 左右 才能 供 机器 人 使用 ， 降压 需要 降压 模块 ， 比如 7805 ， lm2596 芯片 的 dc - dc 直 流转 直流 降压 模块 等等 ， 但 这些 降压 模块 的 输出 电流 普遍 偏小 ， 要 选择 大 电流 输出 的 降压 模块 才行 ， 或者 就是 几个 小 电流 的 降压 模块 并 连在一起 扩流 使用 。 还 一种 方 法 就是 利用 二极管 来 降压 ， 比如 一个 1n4007 测试 可以 降 0.3 v ， 但 一个 二极管 通过 电流 偏小 ， 虽然 标称 1a ， 实际 在 500ma 电流 时 发热量 就 很大 了 ， 所以 要 多个 1n4007 并联 然后 再 串联 多组 ， 然后 接到 电池 上 才能 既 降压 又 能 大 电流 输出 。 这是 麻烦 的 方法 ， 简单 的 就 可以 直接 使用 大功率 整流桥 ， 整流桥 的 内部 是 多个 二极管 交叉 串并联 ， 只 需 选择 一组 就行 ， 比如 d25xb80 整流桥 ， 标称 25a 的 额定电流 ， 实际 接 电池 使用 时 发热量 很小 ， 锂电 组 充满 8.4 v 接 一片 d25xb80 18 个 整体 压降 可以 到 6.9 v ， 接 两片 可以 降到 6.5 v ， 稍高于 6v 使用 上 没有 问题 。 这里 补充 一下 ， 整流桥 就是 整流桥 ， 它 不会 神奇 的 变成 一个 高级 的 降压 器件 ， 在 这个 整体 电路 里 是 利用 它 在 整体 电路 中 发挥 通过 电流 大 ， 物理 减压 ， 限流 的 特点 而 使用 的 。 （ 分析 问题 请 结合 上下文 ， 考虑 整体性 ） 最后 要 强调 一下 ： 最近 发现 大家 都 喜欢 直接 用电 脑 的 usb 供电 来 测试 和 舵机 板 ， 这样 是 绝对 不行 的 。 舵机 的 电流 需求 比 较大 ， 即使 是 9g 的 小 舵机 ， 电流 需求 也 比 usb 的 500ma 电流 要 大 ， usb 可以 给 一个 舵机 供电 ， 但 你 会 发现 转 起来 比较慢 ， 这 就是 供电 不足 ， 同时 usb 的 电压 也 被 拉 低 了 ， 如果 再多接 几个 舵机 ， 要么 烧 舵机 板 ， 要么 烧 电脑 的 usb 电板 。 舵机 控制板 的 认识 和 选购 舵机 控制板 字面 意思 就是 用 于 控制 舵机 的 板子 ， 就 像 驱动 直流电机 一样 ， 机器 人 使用 的 舵机 也 需要 专门 驱动 ， 通过 舵机 的 认知 篇 我们 了解 到 舵机 的 驱动 方法 是 单片机 输出 特定 的 pwm 信号 ， 舵机 接收 到 信号 后经 舵机 内部 电 路 检测 对 比 然后 驱动 内部 的 小型 直流电机 带动 减速 齿轮 组使 舵机 的 输出 轴 转动 到 特定 角度 位置 。 所以 想 控制 舵机 就 需要 学会 单片机 的 程序开发 ， 这 对 一般 的 机器 人 爱好者 来说 难度 挺大 ， 特别 是 没有 接触 单片机 的 。 而 做 一个 仿生 机器 人 一般 都 需要 几个 十几个 舵机 ， 控制 多个 舵机 的 程序 则 更加 复杂 ， 这是 大多数 机器 人 爱好者 在 制作 机器 人 的 过程 中 都 要 遇到 的 一个 大 问题 。 为了 使 大多数 不会 编写 舵机 控制程序 的 机器 人 爱好者 能够 轻松 的 控制 舵机 ， 高手 们 就 专门 开发 了 用 于 多路 舵机 控制 的 硬件 模块 供 其他 不会 编写程序 的 爱好者 使用 。 舵机 控制板 从 硬件 上来 其实 也 就是 一块 单片机 开发板 ， 一片 单片机 加上 一些 外围 电 路 ， 但 由于 开发者 将 多路 舵机 控制程序 写入 到 单片机 中 ， 这个 外表 上 看 普通 的 单片机 开发板 便 有 了 不 一样 的 价 ， 这 就是 软件开发 的 魅力 所在 。 与 许多 技术 一样 ， 舵机 控制板 起源于 国外 ， 国外 比 较 流行 的 就是 开源 的 （ ssc - 32 ） 32 路 舵机 控制板 ， 原理 就是 使用 单片机 的 硬件 pwm 接口 通过 4 个 74hc595 扩展 成 32 路 pwm 输出 ， 实现 32 路 舵机 控制 。 另 一种 方 法 就是 通过 单片机 内部 的 定时器 设置 生成 pwm ， 这样 理论 有 多少 i / o 口 就 能 产生 多少 路 控制 ， 但 随着 路数 的 增加 控制精度 就 会 下降 ， 当然 用 高性能 的 单片机 可以 有 效 避免 这个 问题 。 舵机 控制板 还有 个 方便 之 处 在于 有 一套 与 之 相对 应 的 pc 调试 软件 ， 面向 用户界面 ， 使用 户 能够 更 直观 的 操控 舵机 位移 ， 而且 还 能 把 调整 出来 的 动作 保存 下来 ， 形成 连贯 的 动作 组 ， 这样 便 使得 爱好者 设计 机器 人 步态 的 过程 变得 简单化 ， 让 爱好者 更快 的 享受 制作 机器 人 的 乐趣 。 简单 来说 ， 舵机 控制板 就是 机器 人 的 中枢神经 ， 负责 动作 协调 ， 另外 的 机器 人 主控 就是 大 脑 ， 负责 处理 外界 信息 ， 统一指挥 ， 机器 人 扩展 的 传感器 就是 感官 系统 ， 负责 接收 外界 信息 。 下面 这段 是 后加 的 ， 有 时间 再 整理 （ 新手 必看 ） 简单 说 一下 舵机 控制板 是 什么 ： 舵机 控制板 字面 意思 就是 具有 控制 舵机 能力 的 电路板 ， 是 一种 写 好 舵机 驱动 控制程序 的 单片机 成品 模块 ， 主要 功能 就是 驱动 多 路 舵机 ， 然后 内部 程序 又 写 好 了 与 外部设备 进行 通讯 的 串口 协议 ， 这样 外部设备 就 能 发送 特定 的 指令 给 舵机 控制板 ， 间接 的 控制 多 路 舵机 。 舵机 控制板 就是 这样 的 功能 ， 它 只是 机器 人 控制系统 的 一部分 ， 把 舵机 驱动 控制 的 程序 分离出来 单独 做成 了 一个 软硬件 模块 ， 如果 做 过智能 小车 那就好 理解 了 ， 舵机 控制板 在 仿生 机器 人中 的 作用 跟 电机 驱动 模块 在 智能 小 车里 的 作用 是 一样 了 ， 只不过 前者 看着 要 比 后者 高级 些 。 脱机 运行 ： 字面 意思 就是 能 脱离 电脑 运行 ， 有 两个 方 法 ， 一个 是 按照 仿生 机器 人 的 制作 思路 ， 在 机器 人 主控 的 程序 里 写入 调试 好 的 动作 ， 主控 检测 外界 信息 来 触发 相应 的 动作 发送给 舵机 控制板 ， 这样 就 实现 了 脱机 运行 ； 另外 一种 就是 把 调好 的 动作 组存 到 舵机 控制板 上 的 存储器 中 ， 然后 还是 用 外部设备 来 发送 单个 动作 组 指令 给 舵机 控制板 ， 或者 设置 存储 的 某个 动作 组在 每次 重新 上电后 运行 。 这 两种 方 法 区别 就是 后者 省去 了 前者 在 主控 程序 里 复制粘贴 动作 指令 这个 步骤 。 但 实际上 动作 组 存储 这个 功能 只是 在 机器 人入 门 中 有点 作用 ， 而且 还是 懒人 专用 ， 在 后期 的 高阶 学习 中 ， 机器 人 主控 需要 不断 检测 各种 传感器 数据 ， 分析 融合 ， 实 时 生成 动作 发给 舵机 控制板 来 控制机 器人 姿态 。 舵机 控制板 上 存储 的 动作 组 只是 事先 预设 的 ， 在 需要 固定 动作 套路 的 场合 是 有用 的 ， 在 无规律 判断 场合 就 没用 了 。 新 设计 的 32 路 舵机 控制器 arduino 机器 人 控制器 参数 ： 1 ， 舵机 驱动 mcu 为 32 位 arm , 高速 处理 数据 ， arduino 主控 为 atmega328 ， 32k 程序 空间 ， 开 源程序 设计 ， 让 您 的 机器 人 不 在 傻傻的 跳舞 ， 更具 个性化 。 2 ， 信号 输出 pwm ， 精度 1us ， 分辨率 0.08 度 。 （ 友情 提示 ， 使用 双电源 比单 电源 信号 稳定 ， 如果 控制精度 比较 高 的 伺服电机 ， 舵机 请 用 双电源 模式 ） 3 ， 串口 通讯 方式 ， ttl ， usart , 各种 mcu （ 51 ， avr , arduino ， arm ， pc 等 ） 直接 连接 通讯 4 ， 双 稳压 ic ， 单个 芯片 驱动电流 可达 850ma ， 外接 功能模块 无需 为 供电 不足 而 影响 模块 工作 而 担心 。 5 ， 背面 有 双路 自 恢复 保险丝 ， 避免 用户 在 无意间 接反 电极 而 烧毁 板上 电路 。 6 ， 双电源 和 单 电源 切换 模式 ， 双电源 更 稳定 ， 单 电源 更 轻便 。 7 ， 供电 范围 ， v - m 芯片 供电 6.5 v ~ 9v , v - s 舵机 供电 6.5 v ～ 12v 。 （ 注意 ： 普通 舵机 的 供电 范围 最好 控制 在 6.5 v ～ 7v 左右 ， 只有 高压 舵机 可以 接 12v ） 8 ， 板基 可以 承受 15a ～ 25a 大 电流 供电 ， 普通 的 舵机 板 设计 ， 板基 铜箔 很 薄 ， 最 多 只能 通过 2 ， 3a 的 电流 ， 如果 让 32 路 舵机 全部 一直 工作 ， 板基 肯定 会 发热 ， 这 跟 用 细 的 电线 烧水 电线 会发 烫 一个 道理 。 适合 发烧级 大 电流 高压 舵机 。 9 ， 板载 256k 动作 组 存储芯片 ， 觉得 容量 小 了 ？ 那 我 说 大概 可以 存储 4300 条 动作 ， 按 一个 动作 组 10 条 动作 来算 ， 可以 分成 430 个 动作 组 。 想想 您 的 机器 人 可以 有 430 组 变化 时 ， 这 该是 多么 灵巧 善变 的 机器 人 呀 ^ ^ 。 10 , sorry , 我 要说 sorry 了 ， 因为 我 的 板子 不 支持 别家 所谓 的 脱机 模式 ， 也 就是 上电后 就 傻傻的 跳个 舞 。 但是 ， 板子 一样 可以 实现 上电 就 跳个 舞 的 傻傻的 功能 ， 很 简单 。 11 ， 固定 波特率 115200 ， 因为 舵机 驱动 mcu 啦 ， 处理 高速数据 不是 问题 。 12 ， 板子 尺寸 为 45 × 50cm ， 固定 孔径 3mm ， 孔距 横 向 35mm ， 纵向 45mm ， 斜 向 60mm ， 我 又 要说 了 ， 史上 最小 的 arduino 机器 人 控制器 ， 32 路 舵机 控制器 。 13 ， 完美 的 动作 组 执行 能 力 ， 实时性 媲美 单条 动作 指令 的 发送 ， 可 连续 接收 动作 组 指令 无缝 执行 ， 新 指令 快速 变换 。 14 ， 32 路 同步 驱动 ， 32 路 舵机 全速 运动 板子 无 压力 ， 不 发热 。 15 ， 支持 ps2 手柄 ， 红外 遥控 ， 电脑 遥控 ， 姿态识别 等 ， 即插即用 ， 无需 额 外电路 。 16 ， 板载 arduino 主控 ， 开 源程序 设计 ， 让 您 的 机器 人有 一个 聪明 灵活 的 大脑 。 （ 友情 提示 ， 舵机 控制板 并 不是 仿生 机器 人 的 大脑 ， 它 只 相当于 智能 小 车里 的 电机 驱动 板 ， 在 仿生 机器 人里 只 负责 驱动 舵机 关节 ， 而大脑 必须 具备 可 操控性 ， 修改 性 ， 学习性 ， 一个 完全 开放 的 平台 才 是 正确 的 选择 ， 方便 用 户 自定义 自己 的 机器 人 ， 与众不同 ） 17 ， 通讯 协议 , pc 串口 助手 ： 单条 动作 式 # 1p1000 # 2p1500 # 3p2000 ..........# 32p2500t300 后面 键盘 快捷键 ctrlenter ， 动作 组式 # 1g2c 后面 键盘 快捷键 ctrlenter 。 51 单片机 ： 单条 动作 式 “ # 1p1000 # 2p1500 # 3p2000 ..........# 32p2500t300 | r | n ” 动作 组式 “ # 1g2c | r | n ” . arduino : 单条 动作 式 serial . print “ # 1p1000 # 2p1500 # 3p2000 ..........# 32p2500t300 | r | n ” 动作 组式 serial . print “ # 1g2c | r | n ” ， 或者 serial . println “ # 1p1000 # 2p1500 # 3p2000 ..........# 32p2500t300 ” ， 动作 组式 serial . println “ # 1g2c ” 新 设计 的 32 路 舵机 控制器 arduino 机器 人 控制器 参数 ： 1 ， 舵机 驱动 mcu 为 32 位 arm , 高速 处理 数据 ， arduino 主控 为 atmega328 ， 32k 程序 空间 ， 开 源程序 设计 ， 让 您 的 机器 人 不 在 傻傻的 跳舞 ， 更具 个性化 。 2 ， 信号 输出 pwm ， 精度 1us ， 分辨率 0.08 度 。 （ 友情 提示 ， 使用 双电源 比单 电源 信号 稳定 ， 如果 控制精度 比较 高 的 伺服电机 ， 舵机 请 用 双电源 模式 ） 3 ， 串口 通讯 方式 ， ttl ， usart , 各种 mcu （ 51 ， avr , arduino ， arm ， pc 等 ） 直接 连接 通讯 4 ， 双 稳压 ic ， 单个 芯片 驱动电流 可达 850ma ， 外接 功能模块 无需 为 供电 不足 而 影响 模块 工作 而 担心 。 5 ， 背面 有 双路 自 恢复 保险丝 ， 避免 用户 在 无意间 接反 电极 而 烧毁 板上 电路 。 6 ， 双电源 和 单 电源 切换 模式 ， 双电源 更 稳定 ， 单 电源 更 轻便 。 7 ， 供电 范围 ， v - m 芯片 供电 6.5 v ~ 9v , v - s 舵机 供电 6.5 v ～ 12v 。 （ 注意 ： 普通 舵机 的 供电 范围 最好 控制 在 6.5 v ～ 7v 左右 ， 只有 高压 舵机 可以 接 12v ） 8 ， 板基 可以 承受 15a ～ 25a 大 电流 供电 ， 普通 的 舵机 板 设计 ， 板基 铜箔 很 薄 ， 最 多 只能 通过 2 ， 3a 的 电流 ， 如果 让 32 路 舵机 全部 一直 工作 ， 板基 肯定 会 发热 ， 这 跟 用 细 的 电线 烧水 电线 会发 烫 一个 道理 。 适合 发烧级 大 电流 高压 舵机 。 9 ， 板载 256k 动作 组 存储芯片 ， 觉得 容量 小 了 ？ 那 我 说 大概 可以 存储 4300 条 动作 ， 按 一个 动作 组 10 条 动作 来算 ， 可以 分成 430 个 动作 组 。 想想 您 的 机器 人 可以 有 430 组 变化 时 ， 这 该是 多么 灵巧 善变 的 机器 人 呀 ^ ^ 。 10 , sorry , 我 要说 sorry 了 ， 因为 我 的 板子 不 支持 别家 所谓 的 脱机 模式 ， 也 就是 上电后 就 傻傻的 跳个 舞 。 但是 ， 板子 一样 可以 实现 上电 就 跳个 舞 的 傻傻的 功能 ， 很 简单 。 11 ， 固定 波特率 115200 ， 因为 舵机 驱动 mcu 啦 ， 处理 高速数据 不是 问题 。 12 ， 板子 尺寸 为 45 × 50cm ， 固定 孔径 3mm ， 孔距 横 向 35mm ， 纵向 45mm ， 斜 向 60mm ， 我 又 要说 了 ， 史上 最小 的 arduino 机器 人 控制器 ， 32 路 舵机 控制器 。 13 ， 完美 的 动作 组 执行 能 力 ， 实时性 媲美 单条 动作 指令 的 发送 ， 可 连续 接收 动作 组 指令 无缝 执行 ， 新 指令 快速 变换 。 14 ， 32 路 同步 驱动 ， 32 路 舵机 全速 运动 板子 无 压力 ， 不 发热 。 15 ， 支持 ps2 手柄 ， 红外 遥控 ， 电脑 遥控 ， 姿态识别 等 ， 即插即用 ， 无需 额 外电路 。 16 ， 板载 arduino 主控 ， 开 源程序 设计 ， 让 您 的 机器 人有 一个 聪明 灵活 的 大脑 。 （ 友情 提示 ， 舵机 控制板 并 不是 仿生 机器 人 的 大脑 ， 它 只 相当于 智能 小 车里 的 电机 驱动 板 ， 在 仿生 机器 人里 只 负责 驱动 舵机 关节 ， 而大脑 必须 具备 可 操控性 ， 修改 性 ， 学习性 ， 一个 完全 开放 的 平台 才 是 正确 的 选择 ， 方便 用 户 自定义 自己 的 机器 人 ， 与众不同 ） 17 ， 通讯 协议 , pc 串口 助手 ： 单条 动作 式 # 1p1000 # 2p1500 # 3p2000 ..........# 32p2500t300 后面 键盘 快捷键 ctrlenter ， 动作 组式 # 1g2c 后面 键盘 快捷键 ctrlenter 。 51 单片机 ： 单条 动作 式 “ # 1p1000 # 2p1500 # 3p2000 ..........# 32p2500t300 | r | n ” 动作 组式 “ # 1g2c | r | n ” . arduino : 单条 动作 式 serial . print “ # 1p1000 # 2p1500 # 3p2000 ..........# 32p2500t300 | r | n ” 动作 组式 serial . print “ # 1g2c | r | n ” ， 或者 serial . println “ # 1p1000 # 2p1500 # 3p2000 ..........# 32p2500t300 ” ， 动作 组式 serial . println “ # 1g2c ”"
    keywords = keywordExtractor.extract(title, content, num1=8, num2=12,withscore=True, delete=False)
    print(keywords)
#    task1_train_ids, docid2label = util.load_task1_train_set()
#    word_df = util.load_word_df()
#    it_lexicons = read_lines_as_list('F:/#smp17/#palm/dicts/it_lexicons.txt', skip=1) # it专业名词
#    nnFeatureGenerator = task1_nn_keyword_classifier.NeuralNetworkFeatureGenerator(it_lexicons, word_df)
#    neuralNetworkKeywordClassifier = task1_nn_keyword_classifier.NeuralNetworkKeywordClassifier()
#    neuralNetworkKeywordClassifier.load_model('F:/#smp17/#palm/model/task1/0725_23_34_63.24.h5')
#    for doc_id in task1_train_ids:
#        title, content = util.read_doc_by_id(doc_id)
#        #######################   False
#        word_set ,keywords = keywordExtractor._extract(title, content, alpha=0.22, num1=8, num2=12, delete=False, withscore=False, enrich=False)
#        
#        print(word_set)
#        
#        print('title', title)
##        print('content', content)
#        print(keywords)
#        
#        x = nnFeatureGenerator.gen_feature_of_doc_instance((doc_id, keywords))
#        pred = neuralNetworkKeywordClassifier.predict(x)
#        print(pred)
#        
#        print(docid2label[doc_id])
        
        
        
#        x = nnFeatureGenerator.gen_feature_of_doc_instance((doc_id, keywords))
#        id2test[doc_id] = (x, keywords)
